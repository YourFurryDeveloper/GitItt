<!DOCTYPE html>

<html>
    <head>
        <title>GitItt |</title>
        <link rel="stylesheet" href="styles_thread.css">
    </head>

    <body onload="fetchData()">
        <div id="topbar">
            <p id="sitename">GitItt</p>
            <nav id="topnav">
                <a href="index.html"><button id="navbtn">Home</button></a>
                <a href="reccomended.html"><button id="navbtn">Reccomended</button></a>
                <a href="user-submitted.html"><button id="navbtn">User-Submitted</button></a>
            </nav>
        </div>
        <br>
        <br>
        <br>
        <div id="threadinfo">
            <input id="threadsearch" type="text" placeholder="Search">
            <h1 id="threadname"></h1>
        </div>
        <div class="giscus" id="giscus"></div>

        <script>
            function fetchData() {
                const params = new URLSearchParams(window.location.search);
                const threadname = params.get("thread");

                document.getElementById("threadname").innerHTML = `G/${threadname}`;
                document.getElementById("threadsearch").setAttribute("placeholder", `Search G/${threadname}...`);
                document.title = `GitItt | ${threadname}`

                loadGiscus();
            }

            function searchInThread(searchString) {
                let iframe = document.querySelectorAll("iframe.giscus-frame");
                iframe = iframe[0];
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;


                if (!iframeDoc) {
                    console.error('Cannot access iframe content.');
                    return;
                }

                const elements = iframeDoc.body.getElementsByTagName('*');
                const matches = [];

                // Clear previous highlights
                for (let el of elements) {
                    el.style.backgroundColor = '';
                }

                for (let el of elements) {
                    if (el.innerText && el.innerText.toLowerCase().includes(searchString.toLowerCase())) {
                        el.style.backgroundColor = 'yellow'; // Highlight found elements
                        matches.push(el);
                    }
                }

                if (matches.length === 0) {
                    console.log('No matches found.');
                } else {
                    console.log(`Found ${matches.length} matching elements.`);
                }

                if (matches.length > 0) {
                    matches[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                return matches; // Return found elements if needed
            }

            function loadGiscus() {
                const giscusContainer = document.getElementById('giscus');

                const script = document.createElement('script');
                script.src = 'https://giscus.app/client.js';
                script.setAttribute('data-repo', 'YourFurryDeveloper/GitItt');
                script.setAttribute('data-repo-id', 'R_kgDOO2qTdA');
                script.setAttribute('data-category', 'General');
                script.setAttribute('data-category-id', 'DIC_kwDOO2qTdM4CrE_E');
                script.setAttribute('data-mapping', 'title');
                script.setAttribute('data-strict', '0');
                script.setAttribute('data-reactions-enabled', '0');
                script.setAttribute('data-emit-metadata', '0');
                script.setAttribute('data-input-position', 'top');
                script.setAttribute('data-theme', 'preferred_color_scheme');
                script.setAttribute('data-lang', 'en');
                script.setAttribute('data-loading', 'lazy');
                script.setAttribute('crossorigin', 'anonymous');
                script.async = true;

                giscusContainer.appendChild(script);
            }

            const threadSearchBox = document.getElementById("threadsearch");
            threadSearchBox.addEventListener("input", function() {
                searchInThread(threadSearchBox.value);
            })
        </script>
    </body>
</html>
